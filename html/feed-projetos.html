<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Connexta - Feed de Projetos</title>
    <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Inter:wght@400;500;600;700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="../css/dashboard.css">
    <link rel="stylesheet" href="../css/feed.css">
</head>

<body>
    <script src="../js/particles.js"></script>

    <div class="dashboard">
        <aside class="sidebar">
            <div class="logo">CONNEXTA</div>
            <nav>
                <a href="../html/dashboard-investidor.html">Dashboard</a>
                <a href="../html/feed.html" class="active">Feed</a>
                <a href="../html/configuracoes.html">Configurações</a>
            </nav>
            <div class="user-info">
                <div class="avatar" id="avatarPreview">J</div>
                <div>
                    <div class="name">João Silva</div>
                    <div class="email">joao@exemplo.com</div>
                </div>
                <a href="../index.html" class="logout">Sair</a>
            </div>
        </aside>

        <main class="main">
            <header>
                <h1>Feed de Projetos</h1>
                <p>Invista nas melhores startups do Brasil</p>
            </header>

            <div class="filters">
                <button class="filter-btn active" data-sector="todos">Todos</button>
                <button class="filter-btn" data-sector="saude">Saúde</button>
                <button class="filter-btn" data-sector="fintech">Fintech</button>
                <button class="filter-btn" data-sector="edu">Educação</button>
                <button class="filter-btn" data-sector="sustentabilidade">Sustentabilidade</button>
            </div>

            <!-- CORREÇÃO AQUI: Adicionei id="projetos-container" -->
            <div id="projetos-container" class="projects-grid">
                <!-- Removi os cards estáticos truncados para não conflitar -->
                <!-- O JS vai preencher aqui com cards do Firebase -->
                <div class="loading-message">Carregando projetos...</div> <!-- Fallback enquanto carrega -->
            </div>
        </main>
    </div>

    <!-- Script do Firebase (corrigido para compatibilidade com filtros) -->
    <script type="module">
        import { db } from '../js/firebase.js';
        import { collection, getDocs, query, orderBy } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-firestore.js";

        const container = document.getElementById('projetos-container');

        // === COLOQUE ESTE CÓDIGO NO LUGAR DO SCRIPT QUE CARREGA OS PROJETOS ===
        async function carregarProjetos() {
            const container = document.getElementById('projetos-container');
            if (!container) return;

            try {
                const snapshot = await getDocs(collection(db, "projects"));

                container.innerHTML = ''; // limpa

                if (snapshot.empty) {
                    container.innerHTML = '<p style="text-align:center; color:#aaa; grid-column:1/-1;">Nenhum projeto encontrado.</p>';
                    return;
                }

                snapshot.forEach(doc => {
                    const p = doc.data();
                    const id = doc.id;

                    const progresso = p.meta ? Math.round((p.captado || 0) / p.meta * 100) : 0;

                    const card = document.createElement('div');
                    card.className = 'project-card';
                    card.dataset.sector = (p.categoria || '').toLowerCase();

                    card.innerHTML = `
                <div class="project-image" style="background: linear-gradient(135deg, #667eea, #764ba2);"></div>
                <div class="project-info">
                    <h3>${p.nome || 'Sem nome'}</h3>
                    <p>${p.descricao?.substring(0, 80) || 'Sem descrição'}...</p>
                    </div>
                    <div class="conteiner-progress">
                        <div class="progress">
                            <div class="progress-bar" style="width: ${progresso}%"></div>
                        </div>
                            <p class="valor">R$ ${Number(p.captado || 0).toLocaleString('pt-BR')} de R$ ${Number(p.meta || 0).toLocaleString('pt-BR')}</p>
                        </div>
                        <div class="tag">${p.categoria || 'Geral'}</div>
                        `;

                    // AQUI ESTÁ A MÁGICA: clique no card inteiro abre o projeto
                    card.addEventListener('click', () => {
                        window.location.href = `projeto.html?id=${id}`;
                    });

                    // Botão opcional (se quiser manter)
                    const btn = document.createElement('button');
                    btn.className = 'btn-investir';

                    btn.addEventListener('click', (e) => {
                        e.stopPropagation(); // evita clique duplo
                        window.location.href = `projeto.html?id=${id}`;
                    });
                    card.appendChild(btn);

                    container.appendChild(card);
                });

            } catch (error) {
                console.error("Erro ao carregar projetos:", error);
                container.innerHTML = `<p style="color:red; text-align:center;">Erro ao carregar projetos: ${error.message}</p>`;
            }
        }

        // Chama quando carregar a página
        document.addEventListener("DOMContentLoaded", () => {
            carregarProjetos(carregarProjetos, 1000);
        });
    </script>

    <script src="../js/feed.js"></script>
    <script src="../js/avatar-persistente.js"></script>
    <script src="../js/navigation-animation.js"></script>
</body>

</html>