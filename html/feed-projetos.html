<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Connexta - Feed de Projetos</title>
    <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../css/dashboard.css">
    <link rel="stylesheet" href="../css/feed.css">
</head>
<body>
    <script src="../js/particles.js"></script>

    <div class="dashboard">
        <aside class="sidebar">
            <div class="logo">CONNEXTA</div>
            <nav>
                <a href="../html/dashboard-investidor.html">Dashboard</a>
                <a href="../html/feed.html" class="active">Feed</a>
                <a href="../html/configuracoes.html">Configurações</a>
            </nav>
            <div class="user-info">
                <div class="avatar" id="avatarPreview">J</div>
                <div>
                    <div class="name">João Silva</div>
                    <div class="email">joao@exemplo.com</div>
                </div>
                <a href="../index.html" class="logout">Sair</a>
            </div>
        </aside>

        <main class="main">
            <header>
                <h1>Feed de Projetos</h1>
                <p>Invista nas melhores startups do Brasil</p>
            </header>

            <div class="filters">
                <button class="filter-btn active" data-sector="todos">Todos</button>
                <button class="filter-btn" data-sector="saude">Saúde</button>
                <button class="filter-btn" data-sector="fintech">Fintech</button>
                <button class="filter-btn" data-sector="edu">Educação</button>
                <button class="filter-btn" data-sector="sustentabilidade">Sustentabilidade</button>
            </div>

            <!-- CORREÇÃO AQUI: Adicionei id="projetos-container" -->
            <div id="projetos-container" class="projects-grid">
                <!-- Removi os cards estáticos truncados para não conflitar -->
                <!-- O JS vai preencher aqui com cards do Firebase -->
                <div class="loading-message">Carregando projetos...</div> <!-- Fallback enquanto carrega -->
            </div>
        </main>
    </div>

    <!-- Script do Firebase (corrigido para compatibilidade com filtros) -->
    <script type="module">
    import { db } from '../js/firebase.js';
    import { collection, getDocs, query, orderBy } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-firestore.js";

    const container = document.getElementById('projetos-container');

    async function carregarProjetos() {
        console.log("Tentando carregar projetos da coleção 'projects'...");
        
        try {
            const q = query(collection(db, "projects"), orderBy("nome"));
            const snapshot = await getDocs(q);

            console.log("Snapshot recebido! Quantidade de documentos:", snapshot.size);
            console.log("Documentos:", snapshot.docs.map(doc => ({ id: doc.id, data: doc.data() })));

            container.innerHTML = '';

            if (snapshot.empty) {
                container.innerHTML = '<div class="loading-message">Nenhum projeto encontrado (snapshot vazio).</div>';
                return;
            }

            snapshot.forEach(doc => {
                const p = doc.data();
                const progresso = p.meta ? Math.round((p.captado / p.meta) * 100) : 0;

                const card = `
                    <div class="project-card" data-sector="${(p.categoria || '').toLowerCase()}">
                        <div class="project-image" style="background: linear-gradient(135deg, #00c48c, #009966);"></div>
                        <div class="project-info">
                            <h3>${p.nome || 'Sem nome'}</h3>
                            <p>${p.descricao || 'Sem descrição'}</p>
                            <div class="tag">${p.categoria || 'Geral'}</div>
                        </div>
                        <div class="progress-bar"><div style="width: ${progresso}%"></div></div>
                        <p class="valor">R$ ${Number(p.captado || 0).toLocaleString('pt-BR')} de R$ ${Number(p.meta || 0).toLocaleString('pt-BR')}</p>
                        <button class="btn-investir" onclick="location.href='projeto.html?id=${doc.id}'">
                            Ver Projeto
                        </button>
                    </div>
                `;
                container.innerHTML += card;
            });

            console.log("CARDS CARREGADOS COM SUCESSO!");

        } catch (error) {
            console.error("ERRO FIREBASE:", error);
            container.innerHTML = `<div class="loading-message" style="color:#ff6b6b">Erro: ${error.message}</div>`;
        }
    }

    // Força esperar o Firebase carregar
    setTimeout(carregarProjetos, 1000);
</script>

    <script src="../js/feed.js"></script>
    <script src="../js/avatar-persistente.js"></script>
    <script src="../js/navigation-animation.js"></script>
</body>
</html>